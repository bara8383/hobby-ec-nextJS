# AGENTS.md

> Codex が実装時に最初に読む運用ルールです。迷ったらこのファイルを優先してください。

---

## このプロジェクトの設計・実装方針

以下の 1〜4 は上から順に優先順位が高い。
競合する場合は `1 > 2 > 3 > 4` の順で判断する。

1. Next.js の最新設計を採用する。
2. SEO を高度に最適化する。
3. リアルタイムチャット機能を実装する。
4. AWS に最小コストでデプロイする。

---

## 作業におけるルール

- PR 本文は必ず日本語で、後述「PR 記載テンプレート」に従う。
- リポジトリへ変更を入れる前に必ず作業ブランチを作成する。

---

## 技術的違和感の定義（起票対象の限定）

PR「6) 提案・懸念点」および `docs/proposals.md` に記載する内容は、
以下のいずれかに該当するもののみとする。

---

### 1. codesが想定するECサイトのベストプラクティスとのズレ

例：

- 商品データ構造が将来拡張を考慮していない
- SEO出力（metadata / 構造化データ / canonical 等）が不足している
- 認証・ダウンロード制御が一般的な保護設計と乖離している
- 責務分離が曖昧で将来肥大化する構造になっている
- ルーティング設計がSEO前提になっていない
- 重複ロジックや密結合が発生している

※ 抽象的な「もっと良くできる」は対象外。

---

### 2. 本プロジェクトの設計・実装方針とのズレ

以下との矛盾のみ対象とする：

- Next.js 最新設計の採用
- SEO高度最適化方針
- リアルタイムチャット拡張性確保
- AWS最小コスト方針

例：

- App Router 前提なのに Pages Router 的実装
- 不要な `use client` の多用
- metadata API を使用せず旧式 Head を利用
- キャッシュ戦略が一貫していない
- 明らかにコスト増となる常時処理の追加

---

## 起票禁止事項

以下は提案・懸念点として記載してはならない：

- ユーザー（オーナー）とのチャット内容の転記
- 明示的に指示された仕様そのものへの疑義
- 単なる将来アイデア
- 一般論のみで repo 内根拠がないもの
- 抽象的な改善提案のみで具体的対象がないもの

---

## 起票時の必須条件

- 必ず該当ファイル名または該当設計箇所を明記する。
- 変更差分または既存コードを根拠とする。
- 感想ではなく構造・設計上の論点として記載する。

---

## PR 記載テンプレート

PR の本文は必ずこの順序・見出し名で記載する。

### 1) 実装・修正内容
- 何を変更したかを箇条書きで記載する。
- UI変更時は対象画面/コンポーネント名を書く。

### 2) 実装理由
- 採用理由（性能・保守性・コスト・納期）を詳細に記載する。
- 方針 1〜4 のどれを考慮したか明記する。
- 比較案がある場合は却下理由も記載する。

### 3) 変更ファイル
- 主要ファイルのみを列挙し、各ファイルの変更意図を 1 行で書く。

### 4) 動作確認
- 実行コマンドをコードブロックで記載し、各コマンドに `PASS` / `FAIL` を明記する。
- 手動確認を行った場合は確認手順と結果を記載する。

### 5) 影響範囲
以下 4 項目を必ず記載する（影響なしでも `なし` と書く）：

- Next.js 最新設計への整合性
- SEO 影響
- リアルタイムチャット機能への影響
- AWS コスト影響（増減見込み）

### 6) 提案・懸念点
- 本ファイルで定義された「技術的違和感」に該当するもののみ記載する。
- `docs/proposals.md` に追記する。

### 7) リスクとロールバック
- 想定リスクを箇条書きで記載する。
- 必要に応じてロールバック方法を記載する。
