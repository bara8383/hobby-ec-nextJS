# 90_error_policy

本書は要件定義として、主要なエラー/例外時の基本方針とユーザー導線を定義する。
※表示文言の細部、実装手段、リトライ方式などは設計で扱う。

## 1. 共通方針（UX）
- エラーは「何が起きたか」「ユーザーが次に何をすべきか」を必ず示す
- ユーザーの入力が原因の場合は、該当箇所と修正方法を明示する
- システム都合の場合は、再試行導線・時間をおいて再試行・問い合わせ導線を提示する
- 重要操作（購入、返金、販売停止、通報）は二重実行や重複を避け、結果が不明な場合は安全側に倒す

## 2. 認証・アカウント

### 2.1 会員登録
- メール認証未完了の場合：
  - ログイン/購入/出品など主要機能は利用不可とし、認証完了の案内を表示する
- 登録メールの再送：
  - 再送導線を提示する（乱用対策の具体は設計で扱う）

### 2.2 ログイン
- 認証失敗：
  - エラーを表示し、再入力を促す（具体理由の出し分けはセキュリティ方針に従う）
- 退会済み：
  - ログイン不可である旨を表示し、問い合わせ導線を提示する

### 2.3 パスワード再設定
- 再設定手続き（案内）の有効期限切れ（1時間超過）：
  - 無効である旨を表示し、再申請導線を提示する
- 再設定完了：
  - 完了案内を表示し、ログイン導線を提示する

### 2.4 メールアドレス変更
- 認証未完了の間：
  - 変更は確定していない旨を表示し、再送導線を提示する

## 3. 商品・カート・購入

### 3.1 商品閲覧
- 商品が販売停止/削除等で閲覧不可：
  - 閲覧不可である旨を表示し、一覧へ戻す導線を提示する

### 3.2 カート
- カートに入れた商品が購入時点で販売停止/在庫不可相当（購入不可）：
  - 当該商品を特定して通知し、購入手続きから除外または再選択を促す
- 価格等が更新されていた場合：
  - 更新された旨を表示し、最新内容で再確認させる

### 3.3 購入手続き
- 購入確定時にエラーが発生し、結果が不明な場合：
  - 「処理中/確認中」の案内を出し、注文履歴へ誘導する
  - ユーザーに二重操作を促さない

## 4. 支払い待ちと期限切れ

### 4.1 支払い待ち
- 支払い待ち状態では、支払い期限日時を明確に表示する
- 支払い導線は有効期限内のみ提示する

### 4.2 期限切れ（自動キャンセル）
- 支払い待ち期限超過時：
  - 注文はキャンセルとなり、ユーザーにキャンセル済みを明示する
  - 再注文導線を提示する
- 期限切れ後に支払いが成立してしまった場合（例外ケース）：
  - 注文は復活しない（キャンセルのまま）
  - ユーザーに問い合わせ導線を提示する（個別対応）

## 5. ダウンロード（提供）

### 5.1 DL不可の代表ケース
- 購入成立ではない（支払い待ち/キャンセル/返金済み）：
  - DL不可理由を表示し、注文履歴へ誘導する
- 販売停止後の猶予期間（60日）を超過して提供終了：
  - 提供終了でDL不可である旨を表示し、問い合わせ導線を提示する
- 退会済み（ログイン不可）：
  - DL不可である旨を表示し、問い合わせ導線を提示する

### 5.2 DL処理エラー
- ダウンロード開始に失敗した場合：
  - 再試行を促す（再DLは無制限）
  - 継続して失敗する場合は問い合わせ導線を提示する

## 6. 通知

### 6.1 通知チャネル設定
- 最低1つON制約により、最後の1つをOFFにしようとした場合：
  - 変更できない旨と理由を表示し、代替（もう一方をONにしてからOFF等）を案内する

### 6.2 サイト内通知
- 通知取得に失敗した場合：
  - 再読み込み導線を提示する

## 7. 返金

### 7.1 返金可否
- 未DLのみ返金可、DL済みは返金不可：
  - 返金不可の場合は理由を簡易に示す（DL済みのため等）
- 不正/悪用/規約違反の疑いがある場合：
  - 自動確定せず個別対応とし、案内を表示する

### 7.2 返金実行中のエラー
- 返金処理の結果が不明な場合：
  - 「確認中」の案内を表示し、運営からの連絡/通知を待つ旨を提示する
  - 問い合わせ導線を提示する

### 7.3 返金完了
- 返金済みになった時点で返金完了通知を行う（メール＋サイト内通知、最低1つON）

## 8. 出品・審査（出品者）

### 8.1 出品登録/編集
- 必須項目不足、形式不備等：
  - 該当箇所と修正方法を示す
- 提供物（ファイル）と説明の不整合が疑われる：
  - 初回審査で差し戻しになり得ることを明示（詳細は審査結果で通知）

### 8.2 初回出品審査
- 差し戻し：
  - 修正ポイントを示し、再申請導線を提示する
- 却下：
  - 簡易理由を提示し、問い合わせ導線を提示する
- 審査中：
  - ステータスを表示し、結果通知が来ることを案内する

### 8.3 販売停止
- 出品者による販売停止実行時：
  - 既購入者への通知と提供終了（60日後）が発生する旨を確認画面で示す

## 9. 通報と措置

### 9.1 通報送信
- 通報送信に失敗した場合：
  - 再試行導線を提示し、継続する場合は問い合わせ導線を提示する

### 9.2 措置後の表示
- 一時停止/削除された商品：
  - 購入者には閲覧不可・購入不可を明示
  - 出品者にはステータスと簡易理由を提示する
- 通報者へのフィードバック：
  - 受付完了＋最終結果＋簡易理由を通知する

## 10. 運営操作（管理）

- 審査、返金、停止、精算など重要操作は「実行結果（成功/失敗）」が確認できること
- 失敗時は原因の特定と再実行ができること（具体は設計で扱う）
