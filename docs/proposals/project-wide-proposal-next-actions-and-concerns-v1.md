# プロジェクト提案書（全体向け）v1

## 1. この提案の目的

このドキュメントは**詳細設計そのものではなく**、本プロジェクト全体を前進させるための提案をまとめたものです。
対象は、実装順序・品質管理・運用リスク・今後の進め方です。

---

## 2. いま優先すべきこと（提案）

### 提案A: ドキュメント構造の正式化
- 要件定義: `docs/requirements-definitions/`
- 基本設計: `docs/basic-designs/`
- 詳細設計: `docs/detailed-designs/`
- プロジェクト提案: `docs/proposals/`

**狙い**: 「設計書」と「提案書」の混在を防ぎ、意思決定と実装の責務を分離する。

### 提案B: 実装を4フェーズで小分けに進行
1. SEO + カタログ表示の完成
2. カート/注文導線の成立
3. チャット機能（障害分離前提）の導入
4. テスト自動化・観測性の強化

**狙い**: 学習効率と手戻り抑制のバランスを取る。

### 提案C: 意思決定ログを残す
- `/docs/proposals/decision-log.md` を作り、選択肢・採用理由・却下理由を記録

**狙い**: 後から見返したときに「なぜこう実装したか」を追跡可能にする。

---

## 3. このあとやってほしいこと（提案タスク）

## 3.1 直近（1〜2週間）
- Task-01: SEOの必須項目（metadata / robots / sitemap / JSON-LD）を最小完了
- Task-02: 商品一覧→詳細→カートまでの導線を確実化
- Task-03: 型とバリデーション方針（zod採用有無）を確定

## 3.2 中期（3〜4週間）
- Task-04: 注文APIに二重送信防止（idempotency）を導入
- Task-05: チャット失敗時フォールバックをUI/API双方で統一
- Task-06: 主要ユースケースの結合テストを整備

## 3.3 継続的に実施
- Task-07: ドキュメント更新ルール（PRに反映箇所を明示）
- Task-08: 監視/ログの最低基準（requestId, route, error分類）を実装

---

## 4. プロジェクトの懸念点（リスク）

## 4.1 設計・実装の懸念
- 懸念1: Server Actions と Route Handler の使い分けが曖昧になる
- 懸念2: SEO責務が各ページに分散し重複実装が増える
- 懸念3: チャット機能が購買導線に影響する結合を作ってしまう

## 4.2 品質・運用の懸念
- 懸念4: 購入導線のE2E不足により、回帰不具合が検出しにくい
- 懸念5: エラーログの粒度不足で障害調査に時間がかかる
- 懸念6: noindex方針の不統一でSEO評価に悪影響が出る

## 4.3 マネジメント上の懸念
- 懸念7: 合意前に実装が先行し、後でドキュメントが追従できなくなる
- 懸念8: タスク優先度が不明確で、学習目的と成果物目的が衝突する

---

## 5. 対応方針（提案）

- 方針1: 「1 PR = 1 論点」に分け、レビューで合意形成
- 方針2: 設計変更は先に docs を更新し、次PRで実装
- 方針3: チェックリスト運用（SEO・購入導線・障害分離）を導入

---

## 6. オーナー判断が必要な事項

1. ドキュメント運用の正本をどこに置くか（`docs/nextjs` 継続 or 新ディレクトリ正本化）
2. カート保持方式（Cookie / localStorage / Server Session）
3. 注文時の idempotency を初期から必須にするか
4. `/chat` の index/noindex 方針
5. E2E導入タイミング（初期必須 or フェーズ後半）

---

## 7. 提案採用後のアクション

- Action-1: 本提案の各項目に「採用 / 保留 / 非採用」を付与
- Action-2: 採用項目を要件定義・基本設計・詳細設計へ反映
- Action-3: 実装バックログを Phase 単位で issue 化

