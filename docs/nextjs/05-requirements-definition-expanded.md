# 05. 要件定義（拡充版）

## 1. 目的と背景

本システムは、デジタルアセット（壁紙・アイコン・写真素材など）の販売を行う学習用ECサイトである。
本要件定義は、以下を同時に満たすために定義する。

1. Next.js App Router を中心とした現代的なWeb実装の学習
2. SEOを意識した情報設計・実装
3. 将来的なチャット接客機能の段階的導入

---

## 2. スコープ

### 2.1 対象範囲（In Scope）

- 商品一覧・商品詳細・カート・チェックアウト・購入完了ページ
- SEO基盤（metadata / robots / sitemap / JSON-LD）
- 最小限の決済連携（Route Handler経由）
- チャット機能（現時点は学習用の基本導線）
- 運用を見据えた拡張可能なフォルダ・責務分離

### 2.2 対象外（Out of Scope）

- 会員登録・ログインなどの本格認証
- 在庫連動を伴う外部基幹システム連携
- 本番監視（APM、分散トレーシング）
- 多言語展開（i18n）

---

## 3. ステークホルダー

- **学習者/開発者**: Next.jsのベストプラクティスを学びたい
- **サイト運営者（想定）**: SEO流入とCV導線を改善したい
- **エンドユーザー**: 商品を比較し、迷わず購入・DLしたい

---

## 4. 機能要件

### 4.1 カタログ閲覧

- FR-01: ユーザーは商品一覧ページで商品を閲覧できる
- FR-02: ユーザーは商品詳細ページでタイトル・説明・価格・画像を確認できる
- FR-03: 存在しない商品IDアクセス時はNot Foundを返却する

### 4.2 カート/購入

- FR-04: ユーザーは商品をカートへ追加できる
- FR-05: ユーザーはカート内商品を確認できる
- FR-06: チェックアウトで購入処理を開始できる
- FR-07: 購入成功後、注文ID付きの完了ページへ遷移する

### 4.3 チャット

- FR-08: ユーザーはチャット画面から問い合わせを送信できる
- FR-09: チャットが一時的に利用不可でも、購買導線（一覧/詳細/カート/決済）は継続利用できる

### 4.4 SEO

- FR-10: 主要ページにtitle/description/canonicalを設定する
- FR-11: 商品一覧・詳細に構造化データを設定する
- FR-12: robots/sitemapを提供し、クロール対象を制御する

---

## 5. 非機能要件

### 5.1 パフォーマンス

- NFR-01: 初期表示はServer Componentを基本として不要なクライアントJSを抑制
- NFR-02: ページ単位でキャッシュ戦略（静的生成/再検証/動的）を明示

### 5.2 可用性/障害分離

- NFR-03: チャット障害が発生しても商品閲覧・購入フローは停止しない
- NFR-04: 外部API障害時はユーザー向けに最低限の失敗メッセージを返す

### 5.3 保守性

- NFR-05: SEOロジックは `src/lib/seo.ts` を中心に集約し重複を防ぐ
- NFR-06: 画面責務（app）・部品（components）・業務ロジック（lib/actions）を分離する

### 5.4 セキュリティ

- NFR-07: 決済・注文処理はServer Action/Route Handler側で実行し、クライアントから機密情報を露出しない
- NFR-08: 外部入力（チャットメッセージ等）は検証・サニタイズ可能な構造で扱う

---

## 6. ユースケース（主要）

### UC-01 商品を閲覧して購入する

1. ユーザーが `/products` を閲覧
2. 商品詳細 `/products/[id]` へ遷移
3. カートへ追加
4. `/checkout` で購入手続き
5. `/purchase/success/[orderId]` で完了確認

### UC-02 商品比較中にチャットで相談する

1. ユーザーが商品詳細を閲覧
2. `/chat` へ移動して問い合わせ送信
3. 必要に応じて商品詳細へ戻って購入継続

---

## 7. SEO要件詳細

- SR-01: Home/一覧/詳細をインデックス対象とする
- SR-02: cart/checkout/success/chatは原則noindex方針で運用
- SR-03: JSON-LDはページ種別に応じて `WebSite` / `ItemList` / `Product` を出し分ける
- SR-04: canonical URLは環境依存値でなく正規ドメイン基準で生成する

---

## 8. 受け入れ基準（Acceptance Criteria）

- AC-01: 主要ページにmetadataが設定され、重複titleがない
- AC-02: 商品詳細でJSON-LD `Product` が出力される
- AC-03: robots/sitemapが有効なレスポンスを返す
- AC-04: カート追加〜購入完了まで画面遷移が成立する
- AC-05: チャットAPIに失敗が発生しても商品購入フローは操作可能

---

## 9. 将来拡張要件（任意）

- 認証導入（購入履歴・再DL管理）
- レコメンド機能（閲覧履歴ベース）
- チャットのSSE/WebSocket移行
- 検索・フィルタUIの強化（カテゴリ、価格帯、タグ）
