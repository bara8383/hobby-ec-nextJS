# 要件定義フェーズ 提案・懸念点（意思決定待ち）

このファイルは、要件定義の拡充にあたり、方針決定が必要な論点を集約する。  
最終判断はオーナーが行い、決定後は要件定義本体へ反映する。

## 1. 提案一覧（Decision Queue）

| ID | 区分 | 提案/懸念 | 背景（公式情報ベース） | 推奨案 | 影響範囲 | 優先度 | 判定 |
|---|---|---|---|---|---|---|---|
| P-001 | 提案 | Next.js / Node.js の固定バージョン運用を要件化 | App Router / Server Actions / Metadata の挙動差を減らし、環境差分を抑止するため固定運用が必要 | Next.js は exact version 指定、Node.js は LTS 固定、CI / Docker も同一バージョンに統一する | 実装/CI/ドキュメント | 高 | 採用 |
| P-002 | 提案 | Rendering 戦略の優先順位をページ単位で固定（SSG/ISR/Dynamic） | 公式の Caching/Revalidation 方針ではページごとの明示が推奨される | `/`, `/products`, `/products/[id]`, `/cart`, `/checkout` ごとに既定戦略を定義 | SEO/性能/実装 | 高 | 未決 |
| P-003 | 懸念 | `next export` 前提の静的出力は App Router 機能制限と競合する可能性 | Dynamic Route / Server Actions / Route Handlers の利用時に静的出力制約が出る | 本番想定は SSR/Hybrid 前提、ローカル検証のみ静的配信を許容する旨を要件へ明記 | 配信方式/運用 | 高 | 未決 |
| P-004 | 提案 | SEO の受け入れ基準に「構造化データ検証」を追加 | JSON-LD は出力だけでなく妥当性検証が必要 | CI またはレビューで Rich Results Test 相当の確認手順を定義 | SEO品質 | 中 | 未決 |
| P-005 | 提案 | API エラーモデル（HTTP status + code + message）を要件化 | Route Handlers と外部連携失敗時の表示ゆれを防ぐため | 最低限の共通エラースキーマを FR/NFR に追加 | API/フロント | 中 | 未決 |
| P-006 | 懸念 | Cognito と Keycloak の差分吸収方針が未確定 | ローカル検証と本番移行で issuer/audience/claim 差分が発生 | JWT 検証パラメータを設定化し、固定値ハードコード禁止を要件化 | 認証/セキュリティ | 高 | 未決 |
| P-007 | 提案 | robots/sitemap の運用責任（更新トリガー）を定義 | 商品増減・noindex方針変更時に更新漏れリスク | デプロイ時自動生成 + 変更時レビュー項目化 | SEO運用 | 中 | 未決 |
| P-008 | 提案 | LocalStack 検証の完了条件を「コマンド成功」以外にも拡張 | 単純疎通のみではデータ整合や異常系が担保されない | 正常系/異常系の最小シナリオ（例: 在庫不足）を AC に追加 | 検証品質 | 中 | 未決 |
| P-009 | 提案 | 要件定義ドキュメントの見出し・用語ルールを統一（「要件」に統一、先頭見出し番号を廃止） | 見出しの番号体系が混在すると、参照時の誤解や差分レビューのノイズが増える | `nextjs-ec-requirements-definition-v1.md` の見出し命名規則を固定し、以降の更新時に同ルールを適用 | ドキュメント運用/レビュー効率 | 中 | 未決 |

---

## 2. オーナー判断が必要な論点

1. **本番配信方式の第一候補**を S3 静的ホスティング相当に置くか、Next.js SSR 実行基盤（例: コンテナ/Lambda）を前提に置くか。  
2. **認証導入時期**を要件定義フェーズで固定するか（MVP除外のままか、次フェーズで先行着手するか）。  
3. **SEO測定KPI**（流入・CTR・CVR）の定量目標をこのフェーズで定義するか。  
4. **チャット機能の段階導入**で、SSE と WebSocket のどちらを優先検証するか。
5. **要件定義ドキュメントの表記統一ルール**（見出しの採番方針・「要件/要求」の語彙）をこのフェーズで固定するか。

---

## 3. 更新ルール

- 判定が `採用` になった提案は、`nextjs-ec-requirements-definition-v1.md` に反映する。
- 判定が `却下` の提案は、理由を本ファイルへ1行追記して履歴管理する。
- 公式仕様変更（Next.js/AWS）を検知した場合は、該当提案IDを更新して再判定する。


## 4. 判定履歴（採用/却下）

- P-001（採用）: Next.js/Node.js のバージョン固定ポリシーを要件定義本体へ反映済み。
